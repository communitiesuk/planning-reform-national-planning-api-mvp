name: Heroku
run-name: Create/Update Heroku App

on:
  push:
    branches:
      - main

  workflow_dispatch:
    inputs:
        create:
          description: Whether to create the heroku app
          type: boolean
          required: false
          default: false

env:
  HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
jobs:
  Build:
    runs-on: ubuntu-latest
    environment: dev
    permissions:
      contents: read  # This is required for actions/checkout
      id-token: write # This is required for requesting the JWT
    name: Build Heroku App
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Login to Heroku Container registry
      run: heroku login

    - name: Set Heroku Username and Password
      run: |
        heroku config:set USERNAME=${{ secrets.APP_USERNAME }}
        heroku config:set PASSWORD=${{ secrets.APP_PASSWORD }}

    - name: Create Heroku App
      if: ${{ github.event.inputs.create == 'true' }}
      run: heroku apps:create ${{ secrets.HEROKU_APP_NAME }} --region eu

    - name: Sync with github repository
      if: ${{ github.event.inputs.create == 'true' }}
      run: heroku git:remote --app ${{ secrets.HEROKU_APP_NAME }}

    # - name: Build and push
    #   run: heroku container:push --app ${{ secrets.HEROKU_APP_NAME }} web

    # - name: Release
    #   run: heroku container:release --app ${{ secrets.HEROKU_APP_NAME }} web

    # - name: Confirm
    #   run: heroku ps:scale web=1
